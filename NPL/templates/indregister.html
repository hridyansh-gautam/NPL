<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Individual Registration Form</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='formstyle.css') }}"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.12/build/css/intlTelInput.css"
    />
  </head>
  <body>
    <header>
      <img
        src="{{ url_for('static', filename='images/logo1.png') }}"
        alt="National Physical Laboratory Logo"
        class="logo"
      />
      <div>
        <h1 class="page-title">CSIR - National Physical Laboratory</h1>
        <h3 class="page-subtitle">सी एस आई आर - राष्ट्रीय भौतिक प्रयोगशाला</h3>
      </div>
      <img
        class="company-name"
        src="{{ url_for('static', filename='images/logo2.png') }}"
        alt="CSIR - NPL"
      />
    </header>

    <nav>
      <a href="/">Home</a>
    </nav>

    <div class="container mt-5">
      <form id="registrationForm" action="/indregister" method="POST">
        <div class="row mb-3">
          <div class="col required">
            <label for="firstName" class="form-label">First Name</label>
            <input
              type="text"
              class="form-control"
              id="firstName"
              name="firstName"
              placeholder="First Name"
              required
            />
          </div>
          <div class="col">
            <label for="lastName" class="form-label">Last Name</label>
            <input
              type="text"
              class="form-control"
              id="lastName"
              name="lastName"
              placeholder="Last Name"
              required
            />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-4 required">
            <label for="phone" class="form-label">Phone</label>
            <input
              type="tel"
              class="form-control"
              id="phone"
              name="phone"
              placeholder="Phone"
              required
            />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col required">
            <label for="email" class="form-label">Email</label>
            <input
              type="email"
              class="form-control"
              id="email"
              name="email"
              placeholder="Email"
              required
            />
          </div>
          <div class="col">
            <label for="altEmail" class="form-label">Alternate Email</label>
            <input
              type="email"
              class="form-control"
              id="altEmail"
              name="altEmail"
              placeholder="Alternate Email"
            />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col required">
            <label for="addressLine1" class="form-label">Address Line 1</label>
            <input
              type="text"
              class="form-control"
              id="addressLine1"
              name="addressLine1"
              placeholder="Address Line 1"
              required
            />
          </div>
          <div class="col">
            <label for="addressLine2" class="form-label">Address Line 2</label>
            <input
              type="text"
              class="form-control"
              id="addressLine2"
              name="addressLine2"
              placeholder="Address Line 2"
            />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col required">
            <label for="country" class="form-label">Country</label>
            <select class="form-select" id="country" name="country" required>
            </select>
          </div>
          <div class="col required">
            <label for="state" class="form-label">State</label>
            <select class="form-select" id="state" name="state" required>
              <option selected disabled>Select State</option>
            </select>
          </div>
          <div class="col required">
            <label for="city" class="form-label">City</label>
            <select class="form-select" id="city" name="city" required>
              <option selected disabled>Select City</option>
            </select>
          </div>
          <div class="col required">
            <label for="pincode" class="form-label">Pincode</label>
            <input type="text" class="form-control" id="pincode" name="pincode" placeholder="Pincode" required>
          </div>
        </div>

        <div class="row mb-3 required">
          <div class="col">
            <label for="newPassword" class="form-label">New Password</label>
            <input
              type="password"
              class="form-control"
              id="newPassword"
              name="newPassword"
              placeholder="New Password"
              required
            />
          </div>
          <div class="col required">
            <label for="confirmPassword" class="form-label"
              >Confirm Password</label
            >
            <input
              type="password"
              class="form-control"
              id="confirmPassword"
              name="confirmPassword"
              placeholder="Confirm Password"
              required
            />
          </div>
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.12/build/js/intlTelInput.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.12/build/js/utils.js"></script>

    <script>
      const input = document.querySelector("#phone");
      window.intlTelInput(input, {
        initialCountry: "us",
        utilsScript:
          "https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.12/build/js/utils.js",
      });

      const apiConfig = {
        baseUrl: "https://api.countrystatecity.in/v1",
        apiKey: "NHhvOEcyWk50N2Vna3VFTE00bFp3MjFKR0ZEOUhkZlg4RTk1MlJlaA==",
      };

      const countryDropdown = document.getElementById("country");
      const stateDropdown = document.getElementById("state");
      const cityDropdown = document.getElementById("city");

      function populateDropdown(dropdown, items, defaultText) {
        dropdown.innerHTML = `<option value="">${defaultText}</option>`;
        items.forEach((item) => {
          const option = document.createElement("option");
          option.value = item.iso2 || item.id;
          option.textContent = item.name;
          dropdown.appendChild(option);
        });
      }

      function loadCountries() {
        fetch(`${apiConfig.baseUrl}/countries`, {
          headers: { "X-CSCAPI-KEY": apiConfig.apiKey },
        })
          .then((response) => response.json())
          .then((data) => {
            populateDropdown(countryDropdown, data, "Select Country");
          })
          .catch((error) => console.error("Error loading countries:", error));
      }

      function loadStates(countryCode) {
        fetch(`${apiConfig.baseUrl}/countries/${countryCode}/states`, {
          headers: { "X-CSCAPI-KEY": apiConfig.apiKey },
        })
          .then((response) => response.json())
          .then((data) => {
            populateDropdown(stateDropdown, data, "Select State");
            cityDropdown.innerHTML = '<option value="">Select City</option>';
          })
          .catch((error) => console.error("Error loading states:", error));
      }

      function loadCities(countryCode, stateCode) {
        fetch(
          `${apiConfig.baseUrl}/countries/${countryCode}/states/${stateCode}/cities`,
          {
            headers: { "X-CSCAPI-KEY": apiConfig.apiKey },
          }
        )
          .then((response) => response.json())
          .then((data) => {
            populateDropdown(cityDropdown, data, "Select City");
          })
          .catch((error) => console.error("Error loading cities:", error));
      }

      countryDropdown.addEventListener("change", () => {
        const countryCode = countryDropdown.value;
        if (countryCode) {
          loadStates(countryCode);
        } else {
          stateDropdown.innerHTML = '<option value="">Select State</option>';
          cityDropdown.innerHTML = '<option value="">Select City</option>';
        }
      });

      stateDropdown.addEventListener("change", () => {
        const countryCode = countryDropdown.value;
        const stateCode = stateDropdown.value;
        if (countryCode && stateCode) {
          loadCities(countryCode, stateCode);
        } else {
          cityDropdown.innerHTML = '<option value="">Select City</option>';
        }
      });

      window.onload = loadCountries;

      document
        .getElementById("registrationForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const newPassword = document.getElementById("newPassword").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;

          if (newPassword !== confirmPassword) {
            alert("Passwords do not match!");
            return;
          }

          const formData = new FormData(this);
          fetch("indregister", {
            method: "POST",
            body: formData,
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.json();
            })
            .then((data) => {
              console.log("Success:", data);
              window.location.href = "custlogin";
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });
    </script>
  </body>
</html>
